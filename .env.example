# MinerU Service Configuration

# Redis Configuration
# Note: When using Docker Compose, configure REDIS_URL in docker/.env instead
# This REDIS_URL is only used when running the application directly (not in Docker)
# Options:
#   1. Local Redis: redis://localhost:6379/0
#   2. Remote Redis: redis://192.168.1.100:6379/0
#   3. Redis with password: redis://:password@localhost:6379/0
#   4. Redis with authentication: redis://username:password@localhost:6379/0
REDIS_URL=redis://localhost:6379/0

# API Server Configuration
API_HOST=0.0.0.0
API_PORT=8000

# Storage Configuration
# Storage type: local (local filesystem, shared via Docker volume) or s3 (S3-compatible storage, supports distributed deployment)
MINERU_STORAGE_TYPE=local

# Paths (only used when MINERU_STORAGE_TYPE=local)
TEMP_DIR=/tmp/mineru_temp
OUTPUT_DIR=/tmp/mineru_output

# S3 Storage Configuration (only used when MINERU_STORAGE_TYPE=s3)
# S3-compatible storage configuration (supports MinIO, AWS S3, etc.)
MINERU_S3_ENDPOINT=http://minio:9000
MINERU_S3_ACCESS_KEY=minioadmin
MINERU_S3_SECRET_KEY=minioadmin
MINERU_S3_BUCKET_TEMP=mineru-temp
MINERU_S3_BUCKET_OUTPUT=mineru-output
MINERU_S3_SECURE=false
MINERU_S3_REGION=

# Celery Task Execution
TASK_TIME_LIMIT=7200
TASK_SOFT_TIME_LIMIT=6000
TASK_MAX_RETRIES=0
TASK_RETRY_DELAY=300
RESULT_EXPIRES=86400

# Celery Queue Routing
MINERU_QUEUE=mineru-tasks
MINERU_EXCHANGE=mineru
MINERU_ROUTING_KEY=mineru.tasks

# Worker Configuration
WORKER_NAME=mineru-worker
WORKER_CONCURRENCY=2
# MinerU must use threads pool: MinerU internally uses ProcessPoolExecutor, daemon child processes of prefork pool cannot create child processes
# threads: supports MinerU's internal multi-process handling, but does not support revoke(task_id, terminate=True)
WORKER_POOL=threads
WORKER_MAX_TASKS_PER_CHILD=100
WORKER_PREFETCH_MULTIPLIER=1
WORKER_MAX_MEMORY_PER_CHILD=2000000 # 2GB

# MinerU Device Options: cuda, mps, npu, cpu, auto (auto detect)
MINERU_DEVICE_MODE=auto

# MinerU Parsing Options
MINERU_FORMULA_ENABLE=true
MINERU_TABLE_ENABLE=true
MINERU_PARSE_METHOD=auto
MINERU_LANG=ch
MINERU_EMBED_IMAGES_IN_MD=true
MINERU_RETURN_IMAGES_BASE64=true

# MinerU Model Configuration
# Model source: modelscope, huggingface, local (used by MinerU library, set in Dockerfile for model download)
# Note: This is used by MinerU library itself, not directly by our code
MINERU_MODEL_SOURCE=modelscope

# The type of the model to download: pipeline, vlm, all
MINERU_MODEL_TYPE=pipeline

# Uncoment this to use the CPU as a fallback for MPS, as the operator 'torchvision::nms' is not currently implemented for the MPS device
# PYTORCH_ENABLE_MPS_FALLBACK=1

# MinIO Configuration (Optional, for image uploads only)
# Note: This configuration is only for image upload functionality, independent of storage configuration (MINERU_STORAGE_TYPE)
MINIO_ENDPOINT=
MINIO_ACCESS_KEY=
MINIO_SECRET_KEY=
MINIO_BUCKET=
MINIO_SECURE=false

# Cleanup Scheduler Configuration (Optional)
# Cleanup scheduler configuration (optional, only used when mineru-cleanup service is enabled)
CLEANUP_INTERVAL_HOURS=24
CLEANUP_EXTRA_HOURS=2

# CORS Configuration
# Comma-separated list of allowed origins (leave empty to allow all in development)
# For production, explicitly set allowed origins
CORS_ALLOWED_ORIGINS=
ENVIRONMENT=development

# File Upload Limits
# Maximum file size in bytes (default: 100MB)
MAX_FILE_SIZE=104857600

# Note: Docker build configuration (PIP_INDEX_URL, service ports, etc.) 
# should be configured in docker/.env (copy from docker/.env.example)
